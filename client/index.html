<!DOCTYPE html>
<html>
<head>
	<!-- stylesheets -->
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/code.css">

	<!-- fonts -->
	<link href='http://fonts.googleapis.com/css?family=Cousine' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400' rel='stylesheet' type='text/css'>
	    
</head>

<body>

<div id='wrapper'></div>

	<div id='header'>
		
		<img id="logo-image" src="/img/logo.png" />
		
	</div> 

	<!-- <div id='login-wrapper'>

		<div id="login">

		<div id="logo">
			<img id="logo-image" src="/img/logo.png" />
		</div>
		
			<p class='login-text'>Username</p>
			<input class='login-input' type='text' placeholder='Sergey Brin' id='username' />
			<p class='login-text'>Admin Code</p>
			<input class='login-input' type='password' id='adminCode' />

		</div>

	</div> -->


	<div id="chat">

		<div id='chat-header' class='cf'>
			<img id="chat-logo-image" src="/img/logo.png" />
			<h5>WPI Google Hackathon Chat</h5>
		</div>

		<div id='text-log'></div>

		<div id="text-entry">
			<input type='text' id='chat-message' placeholder="Chat..." />
		</div>
		


	</div>

	

	<div id='codesnoop-wrapper'>

		<div id="commands">
			<button id="start-button">Run</button>
			<button id="stop-button">Stop</button>
		</div>

		<div id="ace-wrapper">
			<div id="editor"></div>
		</div>

		<div id='console'></div>

	</div> <!-- end codesnoop-wrapper -->

<div> <!-- end wrapper -->

	<!-- underscore templates -->
	<script type='text/template' id='log-line'>
		<div class='logger-entry cf'>
			<p class="logger-linenumber"><%= lineNumber %></p>
			<p class="logger-log-line"><%= message %></p>
		</div>
	</script>

	<script type='text/template' id='error-line'>
		<div class='logger-entry cf'>
			<p class="logger-linenumber"><%= lineNumber %></p>
			<img class='error-icon' src='img/error-line-icon.png' />
			<p class="logger-log-line error-line-text"><%= message %></p>
		</div>
	</script>

	<script type='text/template' id='chat-entry'>
		<div class='chat-entry'>
			<p class="chat-entry-name"><%= firstName %><span id='strong'> <%= lastName %></span></p>
			<p class="chat-message-text"><%= chatMessage %></p>
		</div>
	</script>

	<!-- scripts -->
	<script src="js/ace/ace.js" charset="utf-8"></script>
	<script src="js/lib/jquery.js"></script>
	<script src="js/lib/jqueryui.js"></script>
	<script src="js/lib/underscore.js"></script>
	<script src="js/lib/backbone.js"></script>
	<script src="js/lib/socket.io.js"></script>
	<script src="js/models.js"></script>
	<script src="js/code.js"></script>
	<script src="js/views.js"></script>

	<script>

		// staging area for javascript stuff before moving it out of here...
		// connect to the server
		socket = io.connect('http://localhost:2002');

		// chirp a message to the node server
		function socketSend(key, message) {
			socket.emit(key, message);
		}

		// on an ace update, we have to update the ACE view...
		socket.on('serverAceUpdate', function (data) {
			setAceContent(data)
 		});

 		// update a log event received from the server
		socket.on('logEvent', function (data) {
			consoleView.renderFromServer(data);
 		});

		// update an error event received from the server
 		socket.on('errorEvent', function (data) {
			consoleView.renderErrorFromServer(data);
 		});

 		// on status update, update our variables
 		socket.on('server_status', function(data){
 			stopped = !(data == "true");
 			isRunning = (data == "true");
 		});

 		// update a chat event
 		socket.on('chatEvent', function(data){
 			chatView.newServerChatMessage(data);
 		});

 		// ask for the ace message right away
 		socketSend('refreshAce', 'refresh');
 		socketSend('status_running','status');


	</script>

	<script>

		var userName;
		var isAdministrator;

		// do the listener to grab the user's name
		$(document).ready(function() {

			// initially hide the chat
			$('#text-log').css('height', '0');
			$('#text-entry').css('height', '0');

			// debug sets
			userName = "Josh Dickson";
			isAdministrator = true;

			$('#login').keypress(function (e) {
				// if pressing enter and they have a valid two word name
			  	if (e.which == 13 && $('input#username').val().split(" ").length == 2) {
			    	
			    	userName = $('input#username').val();
			    	adminCode = $('input#adminCode').val();

			    	if(adminCode === 'kodiak') {
			    		isAdministrator = true;
			    	} else {
			    		isAdministrator = false;
			    	}

			    	// notify the others that someone new is here...
			    	var nameTokens = userName.split(" ");

			    	var model = new ChatMessage({firstName: nameTokens[0], lastName: nameTokens[1], chatMessage: (nameTokens[0] + ' has joined the chat...')});

			    	socketSend('chatEvent', model);

			    	console.log(userName + " " + adminCode);

			    	$('#login-wrapper').remove();

			    	return false;
			  	}
			});



			// set up the chat toggle to view / hide
			$('#chat-header').click(function() {
				// toggle the height of the chat elements to show/hide...
				var currentHeight = $('#text-log').css('height');

				if(currentHeight === '0px') {
					$('#text-log').css('height', '500px');
					$('#text-entry').css('height', '26px');
					$('input#chat-message').focus();
				} else {
					$('#text-log').css('height', '0');
					$('#text-entry').css('height', '0');
				}
			});

			$('#text-entry').keypress(function (e) {
			  	if (e.which == 13) {
			    	message = $('input#chat-message').val();

			    	if(message.length > 0) {

			    		var nameTokens = userName.split(" ");

			    		var model = new ChatMessage({firstName: nameTokens[0], lastName: nameTokens[1], chatMessage: message});

			    		// log the message and emit to the server
			    		chatView.newChatMessage(model);

			    		$('input#chat-message').val("");

			    	}
			    	


			    	return false;
			  	}
			});

		});


	</script>


</body>

</html>